<!DOCTYPE html>

<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="author" content="fatedier">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Prometheus">
<meta property="og:url" content="https://kingjcy.github.io/"><meta property="og:title" content="Prometheus - kingjcy blog"><meta property="og:site_name" content="kingjcy blog">

<title>
    
    Prometheus - kingjcy blog
    
</title>

<link rel="stylesheet" href="/onlyone/onlyone.css">
<link rel="shortcut icon" href="/assets/favicon.ico">
<script src="/onlyone/onlyone.js"></script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="/index.xml">
</head>
<body>


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">kingjcy blog</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/categories/技术文章/">技术文章</a></li>
                        <li><a href="/categories/读书笔记/">读书笔记</a></li>
                        <li><a href="/categories/人生感悟/">人生感悟</a></li>
                        <li><a href="/tags/">分类</a></li>
                        <li><a href="/about/">关于我</a></li>
                        <li>
                            <form method="get" style="padding: 8px" action="https://www.google.com/search" target="_blank">
                                <input type="hidden" name="sitesearch" value="kingjcy.github.io"/>
                                <input type="text" class="form-control" name="q" placeholder="Press enter to search">
                            </form>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>
    </header>


<div class="posts">
    
    
<article class="post li">
    <header>
        <div class="post-date">
            2020年01月10日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/log/grok_exporter/">prometheus探针系列---- Grok_exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>grok_exporter是基于logstash的grok的插件开发的日志分析工具，可以分析非结构化日志根据正则表达式进行匹配，然后生成适合prometheus的规则规范的metrics。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2020年01月10日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/log/mtail/">prometheus探针系列---- mtail</a>
        </h2>
    </header>
    <div class="post-content">
        <p>mtail是一个可以从应用程序日志中提取指标，并将其导出到时间序列数据库或时间序列计算器中，以便配置警报和仪表盘的工具。</p>

<p>提取由定义了模式和动作的mtail程序来控制。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2019年11月20日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/zabbix/zabbix2tsdb/">Zabbix数据入到tsdb</a>
        </h2>
    </header>
    <div class="post-content">
        <p>由于时序数据库的在监控中的作用，可以将zabbix集成到时序数据库中，完成传统和时序的兼容迁移，现在最主要的就是怎么将数据写入兼容到tsdb中。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2019年06月13日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/cluster/victoriametrics/">prometheus集群系列----VictoriaMetrics</a>
        </h2>
    </header>
    <div class="post-content">
        <p>VictoriaMetrics是一个高性能的，长期存储的prometheus的远程解决方案，实现集群使用的federation的方式，只不过性能很优秀，包括write和query，聚合数据也解决了查询问题。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2019年04月09日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/process_exporter/">Process_exporter</a>
        </h2>
    </header>
    <div class="post-content">
        1.1 安装
wget https://github.com/ncabatoff/process-exporter/releases/download/v0.4.0/process-exporter-0.4.0.linux-amd64.tar.gz tar -xvf process-exporter-0.4.0.linux-amd64.tar.gz -C /usr/local/  配置
选择要监视的进程并将它的分组，提供命令行参数或者使用YAML配置文件两种方法。
整体模版
process_names: - matcher1 - matcher2 ... - matcherN  默认定义全部进程监控
vim conf.yaml process_names: - name: &quot;{{.Comm}}&quot; cmdline: - '.+'  group name 进程名，可以使用变量模版匹配
1.2 模版变量
可用的模板变量：
{{.Comm}} 包含原始可执行文件的basename，换句话说 在/proc/&lt;pid&gt;/stat {{.ExeBase}} 包含可执行文件的basename，这个是name的默认值 {{.ExeFull}} 包含可执行文件的完全限定路径 {{.Username}} contains the username of the effective user {{.Matches}} 映射包含应用命令行所产生的所有匹配项  创建配置文件定义进程名监控
Process-exporter 可以进程名字匹配进程，获取进程信息。匹配规则由name对应的模板变量决定，以下表示监控进程名字为nginx 与 zombie 的进程状态
vim process-name.yaml process_names: - name: &quot;{{.Matches}}&quot; cmdline: - 'nginx' - name: &quot;{{.
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2019年03月12日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/prometheus-operater/">prometheus系列---- Prometheus Operater</a>
        </h2>
    </header>
    <div class="post-content">
        Prometheus-Operator是一套为了方便整合prometheus和kubernetes的开源方案，使用Prometheus-Operator可以非常简单的在kubernetes集群中部署Prometheus服务，用户能够使用简单的声明性配置来配置和管理Prometheus实例，这些配置将响应、创建、配置和管理Prometheus监控实例。
官方地址：https://github.com/coreos/pro... 目前状态：beta状态，还不够完整，但向后兼容。将成为趋势 前置条件：要求k8s的版本&gt;=1.8.0（应该是因为metric api和CRD支持的限制） Operator的核心思想是将Prometheus的部署与它监控的对象的配置分离，做到部署与监控对象的配置分离之后，就可以轻松实现动态配置。使用Operator部署了Prometheus之后就可以不用再管Prometheus Server了，以后如果要添加监控对象或者添加告警规则，只需要编写对应的ServiceMonitor和Prometheus资源就可以，不用再重启Prometheus服务，Operator会动态的观察配置的改动，并将其生成为对应的prometheus配置文件其中Operator可以部署、管理Prometheus Service  四种CRD作用如下：
1.Prometheus: 由 Operator 依据一个自定义资源kind: Prometheus类型中，所描述的内容而部署的 Prometheus Server 集群，可以将这个自定义资源看作是一种特别用来管理Prometheus Server的StatefulSets资源。
2.ServiceMonitor: 一个Kubernetes自定义资源(和kind: Prometheus一样是CRD)，该资源描述了Prometheus Server的Target列表，Operator 会监听这个资源的变化来动态的更新Prometheus Server的Scrape targets并让prometheus server去reload配置(prometheus有对应reload的http接口/-/reload)。而该资源主要通过Selector来依据 Labels 选取对应的Service的endpoints，并让 Prometheus Server 通过 Service 进行拉取（拉）指标资料(也就是metrics信息)，metrics信息要在http的url输出符合metrics格式的信息，ServiceMonitor也可以定义目标的metrics的url。
3.Alertmanager：Prometheus Operator 不只是提供 Prometheus Server 管理与部署，也包含了 AlertManager，并且一样通过一个 kind: Alertmanager 自定义资源来描述信息，再由 Operator 依据描述内容部署 Alertmanager 集群。
4.PrometheusRule:对于Prometheus而言，在原生的管理方式上，我们需要手动创建Prometheus的告警文件，并且通过在Prometheus配置中声明式的加载。而在Prometheus Operator模式中，告警规则也编程一个通过Kubernetes API 声明式创建的一个资源.告警规则创建成功后，通过在Prometheus中使用想servicemonitor那样用ruleSelector通过label匹配选择需要关联的PrometheusRule即可。
安装方式：
创建命名空间：monitoring 执行yaml文件  常见问题：
因为要operator中要支持聚合api，在某些版本的集群上可能需要一些配置，如下：
安装cfssl证书生成工具：http://www.cnblogs.com/xuling... 生成证书
cfssl gencert -ca=/etc/kubernetes/pki/ca.pem -ca-key=/etc/kubernetes/pki/ca-key.pem -config=/etc/kubernetes/pki/ca-config.json -profile=jpaas metrics-server-csr.json | cfssljson -bare metrics-server { &quot;CN&quot;: &quot;aggregator&quot;, &quot;host&quot;: [], &quot;key&quot;: { &quot;algo&quot;: &quot;rsa&quot;, &quot;size&quot;: 2048 }, &quot;names&quot;: [ { &quot;C&quot;: &quot;CN&quot;, &quot;ST&quot;: &quot;BeiJing&quot;, &quot;L&quot;: &quot;BeiJing&quot;, &quot;O&quot;: &quot;k8s&quot;, &quot;OU&quot;: &quot;cloudnative&quot; } ] }  配置master组件参数，以支持metric-server
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2019年02月21日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/redis_exporter/">Redis_exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>这边主要是对redis探针的源码原理进行记录，便于后面使用查看</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年10月09日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/script_exporter/">Script_exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>Prometheus exporter for run script to response metrics.</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年08月09日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/postgres_exporter/">Postgres_exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>Prometheus exporter for PostgreSQL server metrics.</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年07月13日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/cluster/thanos/">Thanos</a>
        </h2>
    </header>
    <div class="post-content">
        <p>Thanos，一组通过跨集群联合、跨集群无限存储和全局查询为Prometheus 增加高可用性的组件。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年07月09日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/mysqld-exporter/">Mysqld Exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>mysql监控指标采集探针:Prometheus exporter for MySQL server metrics.</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年06月13日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/monitor-scheme/infrastructure/">监控架构系列---- Infrastructure</a>
        </h2>
    </header>
    <div class="post-content">
        <p>一个完整的监控体系包括：采集数据、分析存储数据、展示数据、告警以及自动化处理、监控工具自身的安全机制.</p>

<p>使用prometheus进行基础设施监控。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年05月13日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/prometheus-principle/">prometheus系列---- Prometheus Principle</a>
        </h2>
    </header>
    <div class="post-content">
        <p>本篇文章主要是对prometheus的一些原理进行解析。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年05月12日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/monitor-scheme/k8s/">监控架构系列---- K8s监控方案</a>
        </h2>
    </header>
    <div class="post-content">
        <p>一个完整的监控体系包括：采集数据、分析存储数据、展示数据、告警以及自动化处理、监控工具自身的安全机制.</p>

<p>使用prometheus进行kubernetes的容器监控。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年04月09日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/library/client_golang/">prometheus集成库---- Client_golang</a>
        </h2>
    </header>
    <div class="post-content">
        <p>client_golang 是Prometheus client的使用，基于golang语言。提供了prometheus的数据规范。</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2018年03月19日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/exporter/node-exporter/">Node Exporter</a>
        </h2>
    </header>
    <div class="post-content">
        <p>node_exporter 主要用于 *NIX 系统监控, 用 Golang 编写:Prometheus exporter for hardware and OS metrics exposed by *NIX kernels, written in Go with pluggable metric collectors.</p>
    </div>
    </article>
<hr>

    
    
<article class="post li">
    <header>
        <div class="post-date">
            2017年06月29日
        </div>
        <h2 class="post-title">
            <a href="/post/monitor/prometheus/prometheus/">prometheus系列---- Prometheus入门</a>
        </h2>
    </header>
    <div class="post-content">
        <p>Prometheus，它最早是借鉴了 Google 的 Borgmon 系统，完全是开源的，也是CNCF 下继 K8S 之后第二个项目。它们的开发人员都是原 Google 的 SRE，通过 HTTP 的方式来做数据收集，对其最深远的应该是其被设计成一个 self sustained 的系统，也就是说它是完全独立的系统，不需要外部依赖。</p>
    </div>
    </article>
<hr>

    
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2020  kingjcy blog </p>
	<p>Powered by <a href="https://gohugo.io" target="_blank">Hugo</a></p>
</footer>

<script>hljs.initHighlightingOnLoad();</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ace3ec99de96c4080ead1eb8d52db3b3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92600390-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>

