<!DOCTYPE html>

<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="author" content="fatedier">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="在go语言项目中，包的管理很重要，下面看看，有哪些包管理工具。">
<meta property="og:url" content="https://kingjcy.github.io/"><meta property="og:type" content="article">
<meta property="og:title" content="Go Package - kingjcy blog"><meta property="og:site_name" content="kingjcy blog">

<title>
    
    Go Package
    
</title>

<link rel="stylesheet" href="/onlyone/onlyone.css">
<link rel="shortcut icon" href="/assets/favicon.ico">
<script src="/onlyone/onlyone.js"></script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="/index.xml">
</head>
<body>


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">kingjcy blog</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/categories/技术文章/">技术文章</a></li>
                        <li><a href="/categories/读书笔记/">读书笔记</a></li>
                        <li><a href="/categories/人生感悟/">人生感悟</a></li>
                        <li><a href="/tags/">分类</a></li>
                        <li><a href="/about/">关于我</a></li>
                        <li>
                            <form method="get" style="padding: 8px" action="https://www.google.com/search" target="_blank">
                                <input type="hidden" name="sitesearch" value="kingjcy.github.io"/>
                                <input type="text" class="form-control" name="q" placeholder="Press enter to search">
                            </form>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>
    </header>


<div class="row">
    <div class="col-md-8">
        <article class="post single">

            <header>
                <div class="post-date">
                    2016年06月24日 
                </div>
                <h1 class="post-title">Go Package</h1>
            </header>

            <div class="post-content">
                <p>在go语言项目中，包的管理很重要，下面看看，有哪些包管理工具。</p>

<h1 id="包管理工具">包管理工具</h1>

<ul>
<li>go vendor</li>
</ul>

<p>使用vendor管理Golang项目依赖，基本上都是使用这个</p>

<p>Golang 官方并没有推荐最佳的包管理方案。到了1.5版本时代，官方引入包管理的设计，加了 vendor 目录来支持本地包管理依赖。官方 wiki 推荐了多种支持这种特性的包管理工具，如：Godep、gv、gvt、glide、govendor等。</p>

<p>在Golang1.5之后，Go提供了 GO15VENDOREXPERIMENT 环境变量，用于将go build时的应用路径搜索调整成为 当前项目目录/vendor 目录方式。通过这种形式，我们可以实现类似于 godep 方式的项目依赖管理。不过起码在程序编译过程中，再也无需在其他端部署一个 godep 工具。</p>

<p>1.安装一个辅助工具（如果Golang自改一个就好了）</p>

<pre><code>go get -u -v github.com/kardianos/govendor 。
</code></pre>

<p>2.基本操作</p>

<pre><code>$ govendor init
$ ls
main.go    vendor
$ cd vendor/
$ ls
vendor.json
</code></pre>

<p>这个 vendor.json 会类似 godep 工具中的描述文件版本的功能。接下来，需要执行命令将当前应用必须的文件包含进来</p>

<pre><code>$ govendor add +external
</code></pre>

<p>这样会在vendor目录下将必须的编译文件移入进来</p>

<p>这边有一个状态操作</p>

<pre><code>该工具将项目依赖的外部包拷贝到项目下的 vendor 目录下，并通过 vendor.json 文件来记录依赖包的版本，方便用户使用相对稳定的依赖。
对于 govendor 来说，依赖包主要有以下多种类型:

状态  缩写状态    含义
+local  l   本地包，即项目自身的包组织
+external   e   外部包，即被 $GOPATH 管理，但不在 vendor 目录下
+vendor v   已被 govendor 管理，即在 vendor 目录下
+std    s   标准库中的包
+unused u   未使用的包，即包在 vendor 目录下，但项目并没有用到
+missing    m   代码引用了依赖包，但该包并没有找到
+program    p   主程序包，意味着可以编译为执行文件
+outside        外部包和缺失的包
+all        所有的包
</code></pre>

<p>如果需要更新或移除，可以参考一下工具的具体文档使用 update 或者 remove 命令即可。</p>

<pre><code>govendor
  init     Create the &quot;vendor&quot; folder and the &quot;vendor.json&quot; file.                 #创建一个vendor目录并生成个空的verdor.json文件
    list     List and filter existing dependencies and packages.                    #查看已经存在的依赖包
    add      Add packages from $GOPATH.                                             #把$GOPATH中的包拷贝到vendor目录下
    update   Update packages from $GOPATH.                                          #把$GOPATH中的包更新到vendor目录下
    remove   Remove packages from the vendor folder.                                #从vendor目录下移除外部依赖包
    status   Lists any packages missing, out-of-date, or modified locally.          #查看缺失的或者本地修改的包
    fetch    Add new or update vendor folder packages from remote repository.       #从远程代码库拉取依赖包到vendor目录
    sync     Pull packages into vendor folder from remote repository with revisions #一句本地vendor/verdor.json文件指定的包机器版本信息从远程资源库拉取资源
                 from vendor.json file.
    migrate  Move packages from a legacy tool to the vendor folder with metadata.   
    get      Like &quot;go get&quot; but copies dependencies into a &quot;vendor&quot; folder.          #等于go get 但是同步外部依赖包到vendor目录，而不是$GOPATH/src
    license  List discovered licenses for the given status or import paths.             
    shell    Run a &quot;shell&quot; to make multiple sub-commands more efficient for large   
                 projects.
</code></pre>

<p>常规使用</p>

<pre><code>Quickstart
# Setup your project.
cd &quot;my project in GOPATH&quot;
# 初始化 vendor 目录, project 下出现 vendor 目录
govendor init

# Add existing GOPATH files to vendor.
govendor add +external

# View your work.
govendor list

# Look at what is using a package
govendor list -v fmt

# Specify a specific version or revision to fetch
govendor fetch golang.org/x/net/context@a4bbce9fcae005b22ae5443f6af064d80a6f5a55

# Get latest v1.*.* tag or branch.
govendor fetch golang.org/x/net/context@v1   

# Get the tag or branch named &quot;v1&quot;.
govendor fetch golang.org/x/net/context@=v1  

# Update a package to latest, given any prior version constraint
govendor fetch golang.org/x/net/context

# Format your repository only
govendor fmt +local

# Build everything in your repository only
govendor install +local
</code></pre>

<ul>
<li>Godep</li>
</ul>

<p>发现好多golang项目都使用到godep作为包管理的工具，像比较大型的项目，比如kubernetes这种，都是使用的是godep来进行依赖管理操作的了，看了一下有点像maven的感觉</p>

<p>godep是解决包依赖的管理工具，目前最主流的一种，原理是扫描记录版本控制的信息，并在go命令前加壳来做到依赖管理</p>

<p>godep 建议在 golang 1.6 以后使用</p>

<p>godep 依赖 vendor 具体查看 <a href="https://stackoverflow.com/questions/37237036/how-should-i-use-vendor-in-go-1-6">https://stackoverflow.com/questions/37237036/how-should-i-use-vendor-in-go-1-6</a></p>

<p>安装</p>

<pre><code>go get github.com/tools/godep
</code></pre>

<p>编译和运行</p>

<p>项目用godep管理后，要编译和运行项目的时候再用go run和go build显然就不行了，因为go命令是直接到GOPATH目录下去找第三方库。 而使用godep下载的依赖库放到Godeps/workspace目录下的；</p>

<pre><code>godep go run main.go
godep go build
godep go install
godep go test
godep中的go命令，就是将原先的go命令加了一层壳，执行godep go的时候，会将当前项目的workspace目录加入GOPATH变量中；

godep save
godep save将项目中使用到的第三方库复制到项目的Godeps目录下。
</code></pre>

<p>godep save 会自动扫描当前目录所属包中import的所有外部依赖库（非系统库），并查看其是否属于某个代码管理工具（比如git，hg）。若是，则把此库获取路径和当前对应的revision（commit id）记录到当前目录Godeps下的Godeps.json，同时，把不含代码管理信息（如.git目录）的代码拷贝到Godeps/_workspace/src下，用于后继godep go build等命令执行时固定查找依赖包的路径。</p>

<p>因此，godep save能否成功执行需要有两个要素： 当前或者需扫描的包均能够编译成功：因此所有依赖包事先都应该已经或go get或手工操作保存到当前GOPATH路径下 依赖包必须使用了某个代码管理工具（如git，hg）：这是因为godep需要记录revision</p>

<pre><code>godep restore
</code></pre>

<p>如果下载的项目中只有Godeps.json文件，而没有包含第三库则可以使用godep restore这个命令将所有的依赖库下来下来到GOPATH的src中。</p>

<p>godep restore执行时，godep会按照Godeps/Godeps.json内列表，依次执行go get -d -v 来下载对应依赖包到GOPATH路径下，因此，如果某个原先的依赖包保存路径（GOPATH下的相对路径）与下载url路径不一致，比如kuberbetes在github上路径是github.com/kubernetes，而代码内import则是k8s.io，则会导致无法下载成功，也就是说godep restore不成功。这种只能手动，比如手动创建$GOPATH/k8s.io目录，然后git clone。</p>

<p>godep</p>

<p>看见他的star比govendor,所以我使用它.官方地址 <a href="https://github.com/tools/godep">https://github.com/tools/godep</a></p>

<p>install
go get github.com/tools/godep
start using
确认当前项目能够正常的go build, 然后在当前项目下使用以下命令:</p>

<p>godep save
成功了的话将会在当前目录生成 Godeps和vendor目录, Godeps 里Godeps.json 存放当前vendor里的包信息, vendor就是依赖包</p>

<p>build with vendor
go build main.go
使用go1.5以上并且设置环境变量 GO15VENDOREXPERIMENT=1 才能使用. 你可以把gopath里的依赖包注释掉再build以测试是否使用的是vendor.</p>

<p>Update a Dependency
更新vendor依赖包</p>

<p>新加</p>

<p>go get a/b/xxx 然后在你的代码里编写好新代码,重新godep save,godep会自动查找依赖并加入到vendor</p>

<p>更新</p>

<p>go get a/b/xxx 然后再 godep update a/b/&hellip; 三个点表示通配符. 如果你的依赖包在github上没有更改, 你只是想还原vendor里的代码, 你也可以运行 godep update 去还原你修改了的vendor代码</p>

<p>more
godep -help 和 看错误报告 如没提交的git代码是不是godep save的</p>

<ul>
<li>golang自带包管理工具</li>
</ul>

<p>自带工具：go get go get可以将依赖的第三方库下载本GOPATH目录，在代码中直接import相应的代码库就可以了。</p>

<p>与godep相比，如果项目引用的第三方库没有列入到项目里面，安装项目时，针对第三方库需要使用go get一个个下载，比较麻烦；</p>

<p>注：使用godep restore可能导致部分库无法下载下来；编译会报错： cmd/decode.go:16:2: cannot find package &ldquo;github.com/CodisLabs/redis-port/pkg/libs/atomic2&rdquo; in any of:</p>

<p>此时针对报错的特定库再go get一般都能下载： go get github.com/CodisLabs/redis-port/pkg/libs/atomic2</p>

<ul>
<li>go mod</li>
</ul>

<p>Golang 1.11 版本引入的 go mod ，其思想类似maven：目的就是为了：摒弃vendor和GOPATH，拥抱本地库。</p>

<p>为什么要使用这个</p>

<p>vendor这个特性。开发过前端的同学对node modules一定印象深刻，得益于前端混乱的包管理，一个普通的web前端，其node modules往往非常巨大，而且它是每工程的，也就是说如果有2个前端工程，就会有两份巨大的node moudles，里面有成千上万个文件，常常造成IDE挂死，也非常浪费硬盘。</p>

<p>那么，vendor是不是到后期也会变成这样呢？同样的库，同样的版本，就因为在不同的工程里用了，就要在vendor里单独搞一份，不浪费吗？所以这些基于vendor的包管理工具，都会有这个问题。</p>

<p>其实最主要的是去除GOPATH这个问题。</p>

<p>go mod的使用</p>

<p>升级后，可以设置通过一个环境变量GO111MODULE来激活modules：</p>

<pre><code>GO111MODULE=off，go命令行将不会支持module功能，寻找依赖包的方式将会沿用旧版本那种通过vendor目录或者GOPATH模式来查找。
GO111MODULE=on，go命令行会使用modules，而一定也不会去GOPATH目录下查找。忽略GOPATH目录
GO111MODULE=auto，默认值，go命令行将会根据当前目录来决定是否启用module功能。这种情况下可以分为两种情形：当前目录在GOPATH/src之外且该目录包含go.mod文件，或者当前文件在包含go.mod文件的目录下面。
</code></pre>

<p>当module功能启用时，GOPATH在项目构建过程中不再担当import的角色，但它仍然存储下载的依赖包，具体位置在$GOPATH/pkg/mod。</p>

<p>go mod文件解释</p>

<p>有四种指令：module，require，exclude，replace。</p>

<p>module：模块名称&mdash;-也就是当前项目的指定的路径。
require：依赖包列表以及版本
exclude：禁止依赖包列表（仅在当前模块为主模块时生效）
replace：替换依赖包列表 （仅在当前模块为主模块时生效）</p>

<p>go mod 命令使用</p>

<pre><code>go mod init &lt;项目模块名称&gt;初始化模块，会在项目根目录下生成 go.mod 文件。参数&lt;项目模块名称&gt;是非必写的，但如果你的项目还没有代码编写，这个参数能快速初始化模块。如果之前使用其它依赖管理工具(比如dep，glide等)，mod会自动接管原来依赖关系。
</code></pre>

<p>当我们使用 go build、go test 以及 go list 时，Go 会自动更新 go.mod 文件，并且将依赖关系写入其中。go 自动查找了依赖并完成下载，但是下载的依赖包并不是下载到了 $GOPATH 中，而是在 $GOPATH/pkg/mod 目录下，且多个项目可以共享缓存的 module</p>

<pre><code>go build -mod
-mod mode
        module download mode to use: readonly, release, or vendor.


go mod tidy //拉取缺少的模块，移除不用的模块。
go mod download //下载依赖包
go mod graph //打印模块依赖图
go mod vendor //将依赖复制到vendor下
go mod verify //校验依赖
go mod why //解释为什么需要依赖
go list -m -json all //依赖详情
</code></pre>

<p>其它命令可以通过go help mod来查看。</p>

<p>go mod原理</p>

<p>其实在环境变量中已经说明的很清楚了，能够直接使用本地库，不一定非要把库放到对应项目 ，慢慢的取代GOPATH和项目的关联，GOPATH目录用来缓存对应的包，并且能够制定使用的版本。和maven思想一样，但是她并不和vendor冲突，可以兼容使用。</p>

<p>go mod的管理方式是一种趋势，但是目前在源码管理这一块有点完善，编译使用特别方便，自动下载，还可以指定vendor，但是在代码查看的时候找不到对应的库源码位置，不能加载到mod下面的库。目前适合和vendor兼容使用，推荐还是要建立gopath，基础上，使得依赖一抹了然。</p>

<p>使用replace替换无法直接获取的package&ndash;可以用于指定版本来编译，使用旧版本就是这样使用。</p>

<p>由于某些已知的原因，并不是所有的package都能成功下载，比如：golang.org下的包。</p>

<p>modules 可以通过在 go.mod 文件中使用 replace 指令替换成github上对应的库，比如：</p>

<pre><code>replace (
    golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a =&gt; github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a
)
</code></pre>

<p>或者</p>

<pre><code>replace golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a =&gt; github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a
</code></pre>

<p>不管其他地方使用了什么版本，最后还是使用replace里面的版本</p>

<p>基本使用方法</p>

<p>1.clone一个项目</p>

<p>2.使用 go build -mod=&rdquo;  来编译下载需要的包到环境变量GOPATH的pkg目录下</p>

<p>3.如果需要在idea中查看，就将依赖包加载到vendor中 go mod vendor</p>

<p>可以看见对于项目就不需要设置gopath，所有项目编译直接引用$GOPATH/pkg/mod下面的包，下载也到这个地方，还有对应的版本控制，然后还可以将包直接加载到vendor中便于查看，解决了以前路径相对繁琐的问题。</p>
            </div>
            
            <div style="border: 1px dashed #e0e0e0; margin-bottom: 15px; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
                <div>
                    <p style="margin-top:0px;">作者：<a target="_blank" href="http://blog.fatedier.com/">kingjcy</a>
                    <br />本文出处：<a target="_blank" href="https://kingjcy.github.io/post/golang/go-package/">https://kingjcy.github.io/post/golang/go-package/</a>
                    <br />
                    文章版权归本人所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接，否则保留追究法律责任的权利。 </p>
                </div>
            </div>

            <aside>
                
                <ul class="list-inline post-tags">
                    
                    <li>
                        <a href="/tags/package/">
                            <i class="fa fa-tags"></i>
                            package
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/golang/">
                            <i class="fa fa-tags"></i>
                            golang
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/vendor/">
                            <i class="fa fa-tags"></i>
                            vendor
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/godep/">
                            <i class="fa fa-tags"></i>
                            godep
                        </a>
                    </li>
                    
                </ul>

                
                
                <h4 id="real-rels">相关文章</h4>
                <ul class="post-rels" id="real-rels"><li id="li-rels"><a href="/post/golang/benchmark/">golang使用系列---- Benchmark</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2020年01月10日)</span></li><li id="li-rels"><a href="/post/golang/go-crypto-tls/">Golang使用系列---- Crypto/Tls</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年11月19日)</span></li><li id="li-rels"><a href="/post/golang/go-web-safe/">Golang web系列---- Safe</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年11月10日)</span></li><li id="li-rels"><a href="/post/golang/go-rate/">Golang使用系列---- Rate</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年11月10日)</span></li><li id="li-rels"><a href="/post/golang/go-container-list/">golang使用系列---- List</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年10月11日)</span></li><li id="li-rels"><a href="/post/golang/go-container-heap/">golang使用系列---- heap</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年10月11日)</span></li><li id="li-rels"><a href="/post/golang/go-proxy/">golang系列---- Go Proxy</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年10月07日)</span></li><li id="li-rels"><a href="/post/golang/go-gc/">golang使用系列---- Gc</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年08月27日)</span></li><li id="li-rels"><a href="/post/golang/go-encode/">Golang使用系列---- encode</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年06月17日)</span></li><li id="li-rels"><a href="/post/golang/go-crypto/">golang使用系列---- Crypto</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019年06月06日)</span></li></ul>
            </aside>
                
            
            <footer>
                <nav>
                    <ul class="pager">

                        
                        <li class="previous"><a href="/post/golang/go-builtin/"><span aria-hidden="true">&larr;</span> Prev</a></li>
                        

                        <li><a href="/post/">All Posts</a></li>

                        
                        <li class="next"><a href="/post/golang/go-path/">Next <span aria-hidden="true">&rarr;</span></a></li>
                        

                    </ul>
                </nav>
            </footer>

        </article>
    </div>
    <div class="col-md-4">
        
<aside>
        <div class="toc panel panel-default hidden-xs hidden-sm affix-top" data-spy="affix" data-offset-top="125" data-offset-bottom="300">
            <div class="panel-heading">
                <h2 class="panel-title">Catalog</h2>
            </div>

            <nav id="TableOfContents">
<ul>
<li><a href="#包管理工具">包管理工具</a></li>
</ul>
</nav>
        </div>
</aside>

    </div>
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2020  kingjcy blog </p>
	<p>Powered by <a href="https://gohugo.io" target="_blank">Hugo</a></p>
</footer>

<script>hljs.initHighlightingOnLoad();</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ace3ec99de96c4080ead1eb8d52db3b3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92600390-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>

