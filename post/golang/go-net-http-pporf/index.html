<!DOCTYPE html>

<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="author" content="fatedier">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="PProf æƒ³è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œé¦–å…ˆç©ç›®åœ¨ Go è‡ªèº«æä¾›çš„å·¥å…·é“¾æ¥ä½œä¸ºåˆ†æä¾æ®ï¼Œæœ¬æ–‡å°†å¸¦ä½ å­¦ä¹ ã€ä½¿ç”¨ Go åèŠ±å›­ï¼Œæ¶‰åŠå¦‚ä¸‹ï¼š
runtime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ net/http/pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ  å…¶å®net/http/pprofä¸­åªæ˜¯ä½¿ç”¨runtime/pprofåŒ…æ¥è¿›è¡Œå°è£…äº†ä¸€ä¸‹ï¼Œå¹¶åœ¨httpç«¯å£ä¸Šæš´éœ²å‡ºæ¥
åŸç† pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·
pprof ä»¥ profile.proto è¯»å–åˆ†ææ ·æœ¬çš„é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šä»¥å¯è§†åŒ–å¹¶å¸®åŠ©åˆ†ææ•°æ®ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Šï¼‰
profile.proto æ˜¯ä¸€ä¸ª Protocol Buffer v3 çš„æè¿°æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ç»„ callstack å’Œ symbolization ä¿¡æ¯ï¼Œ ä½œç”¨æ˜¯è¡¨ç¤ºç»Ÿè®¡åˆ†æçš„ä¸€ç»„é‡‡æ ·çš„è°ƒç”¨æ ˆï¼Œæ˜¯å¾ˆå¸¸è§çš„ stacktrace é…ç½®æ–‡ä»¶æ ¼å¼
ä½¿ç”¨ æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼
Report generationï¼šæŠ¥å‘Šç”Ÿæˆ Interactive terminal useï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨ Web interfaceï¼šWeb ç•Œé¢  å¯ä»¥åšä»€ä¹ˆ
CPU Profilingï¼šCPU åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº CPUï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— CPU å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½® Memory Profilingï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼ Block Profilingï¼šé˜»å¡åˆ†æï¼Œè®°å½• goroutine é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½® Mutex Profilingï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ  å®ä¾‹ æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•ä¸”æœ‰ç‚¹é—®é¢˜çš„ä¾‹å­ï¼Œç”¨äºåŸºæœ¬çš„ç¨‹åºåˆæ­¥åˆ†æ
package main import ( &quot;log&quot; &quot;net/http&quot; _ &quot;net/http/pprof&quot; &quot;github.">
<meta property="og:url" content="https://kingjcy.github.io/"><meta property="og:type" content="article">
<meta property="og:title" content="golangä½¿ç”¨ç³»åˆ—---- net/http/pprof - kingjcy blog"><meta property="og:site_name" content="kingjcy blog">

<title>
    
    golangä½¿ç”¨ç³»åˆ—---- net/http/pprof
    
</title>

<link rel="stylesheet" href="/onlyone/onlyone.css">
<link rel="shortcut icon" href="/assets/favicon.ico">
<script src="/onlyone/onlyone.js"></script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="/index.xml">
</head>
<body>


<div class="container">
    <header class="nav">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">kingjcy blog</a>
                </div>

                <div class="collapse navbar-collapse" id="navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/categories/æŠ€æœ¯æ–‡ç« /">æŠ€æœ¯æ–‡ç« </a></li>
                        <li><a href="/categories/è¯»ä¹¦ç¬”è®°/">è¯»ä¹¦ç¬”è®°</a></li>
                        <li><a href="/categories/äººç”Ÿæ„Ÿæ‚Ÿ/">äººç”Ÿæ„Ÿæ‚Ÿ</a></li>
                        <li><a href="/tags/">åˆ†ç±»</a></li>
                        <li><a href="/about/">å…³äºæˆ‘</a></li>
                        <li>
                            <form method="get" style="padding: 8px" action="https://www.google.com/search" target="_blank">
                                <input type="hidden" name="sitesearch" value="kingjcy.github.io"/>
                                <input type="text" class="form-control" name="q" placeholder="Press enter to search">
                            </form>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>
    </header>


<div class="row">
    <div class="col-md-8">
        <article class="post single">

            <header>
                <div class="post-date">
                    2018å¹´09æœˆ26æ—¥ 
                </div>
                <h1 class="post-title">golangä½¿ç”¨ç³»åˆ—---- net/http/pprof</h1>
            </header>

            <div class="post-content">
                

<h1 id="pprof">PProf</h1>

<p>æƒ³è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œé¦–å…ˆç©ç›®åœ¨ Go è‡ªèº«æä¾›çš„å·¥å…·é“¾æ¥ä½œä¸ºåˆ†æä¾æ®ï¼Œæœ¬æ–‡å°†å¸¦ä½ å­¦ä¹ ã€ä½¿ç”¨ Go åèŠ±å›­ï¼Œæ¶‰åŠå¦‚ä¸‹ï¼š</p>

<pre><code>runtime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ
net/http/pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ
</code></pre>

<p>å…¶å®net/http/pprofä¸­åªæ˜¯ä½¿ç”¨runtime/pprofåŒ…æ¥è¿›è¡Œå°è£…äº†ä¸€ä¸‹ï¼Œå¹¶åœ¨httpç«¯å£ä¸Šæš´éœ²å‡ºæ¥</p>

<h1 id="åŸç†">åŸç†</h1>

<p>pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·</p>

<p>pprof ä»¥ profile.proto è¯»å–åˆ†ææ ·æœ¬çš„é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šä»¥å¯è§†åŒ–å¹¶å¸®åŠ©åˆ†ææ•°æ®ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Šï¼‰</p>

<p>profile.proto æ˜¯ä¸€ä¸ª Protocol Buffer v3 çš„æè¿°æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ç»„ callstack å’Œ symbolization ä¿¡æ¯ï¼Œ ä½œç”¨æ˜¯è¡¨ç¤ºç»Ÿè®¡åˆ†æçš„ä¸€ç»„é‡‡æ ·çš„è°ƒç”¨æ ˆï¼Œæ˜¯å¾ˆå¸¸è§çš„ stacktrace é…ç½®æ–‡ä»¶æ ¼å¼</p>

<h1 id="ä½¿ç”¨">ä½¿ç”¨</h1>

<p>æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼</p>

<pre><code>Report generationï¼šæŠ¥å‘Šç”Ÿæˆ
Interactive terminal useï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨
Web interfaceï¼šWeb ç•Œé¢
</code></pre>

<p>å¯ä»¥åšä»€ä¹ˆ</p>

<pre><code>CPU Profilingï¼šCPU åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº CPUï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— CPU å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®
Memory Profilingï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼
Block Profilingï¼šé˜»å¡åˆ†æï¼Œè®°å½• goroutine é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®
Mutex Profilingï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ
</code></pre>

<h1 id="å®ä¾‹">å®ä¾‹</h1>

<p>æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•ä¸”æœ‰ç‚¹é—®é¢˜çš„ä¾‹å­ï¼Œç”¨äºåŸºæœ¬çš„ç¨‹åºåˆæ­¥åˆ†æ</p>

<pre><code>package main

import (
    &quot;log&quot;
    &quot;net/http&quot;
    _ &quot;net/http/pprof&quot;
    &quot;github.com/EDDYCJY/go-pprof-example/data&quot;
)

func main() {
    go func() {
        for {
            log.Println(data.Add(&quot;https://github.com/EDDYCJY&quot;))
        }
    }()

    http.ListenAndServe(&quot;0.0.0.0:6060&quot;, nil)
}



package data

var datas []string

func Add(str string) string {
    data := []byte(str)
    sData := string(data)
    datas = append(datas, sData)

    return sData
}
</code></pre>

<p>è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½ çš„ HTTP æœåŠ¡ä¼šå¤šå‡º /debug/pprof çš„ endpoint å¯ç”¨äºè§‚å¯Ÿåº”ç”¨ç¨‹åºçš„æƒ…å†µ</p>

<h1 id="åˆ†æ">åˆ†æ</h1>

<p>ä¸€ã€é€šè¿‡ Web ç•Œé¢</p>

<p>æŸ¥çœ‹å½“å‰æ€»è§ˆï¼šè®¿é—® <a href="http://127.0.0.1:6060/debug/pprof/">http://127.0.0.1:6060/debug/pprof/</a></p>

<pre><code>/debug/pprof/

profiles:
0    block
5    goroutine
3    heap
0    mutex
9    threadcreate

full goroutine stack dump
</code></pre>

<p>è¿™ä¸ªé¡µé¢ä¸­æœ‰è®¸å¤šå­é¡µé¢ï¼Œå’±ä»¬ç»§ç»­æ·±ç©¶ä¸‹å»ï¼Œçœ‹çœ‹å¯ä»¥å¾—åˆ°ä»€ä¹ˆï¼Ÿ</p>

<pre><code>cpuï¼ˆCPU Profilingï¼‰: $HOST/debug/pprof/profileï¼Œé»˜è®¤è¿›è¡Œ 30s çš„ CPU Profilingï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æç”¨çš„ profile æ–‡ä»¶
blockï¼ˆBlock Profilingï¼‰ï¼š$HOST/debug/pprof/blockï¼ŒæŸ¥çœ‹å¯¼è‡´é˜»å¡åŒæ­¥çš„å †æ ˆè·Ÿè¸ª
goroutineï¼š$HOST/debug/pprof/goroutineï¼ŒæŸ¥çœ‹å½“å‰æ‰€æœ‰è¿è¡Œçš„ goroutines å †æ ˆè·Ÿè¸ª
heapï¼ˆMemory Profilingï¼‰: $HOST/debug/pprof/heapï¼ŒæŸ¥çœ‹æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µ
mutexï¼ˆMutex Profilingï¼‰ï¼š$HOST/debug/pprof/mutexï¼ŒæŸ¥çœ‹å¯¼è‡´äº’æ–¥é”çš„ç«äº‰æŒæœ‰è€…çš„å †æ ˆè·Ÿè¸ª
threadcreateï¼š$HOST/debug/pprof/threadcreateï¼ŒæŸ¥çœ‹åˆ›å»ºæ–°OSçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª
</code></pre>

<p>äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨</p>

<p>ï¼ˆ1ï¼‰go tool pprof <a href="http://localhost:6060/debug/pprof/profile?seconds=60">http://localhost:6060/debug/pprof/profile?seconds=60</a></p>

<pre><code>$ go tool pprof http://localhost:6060/debug/pprof/profile\?seconds\=60

Fetching profile over HTTP from http://localhost:6060/debug/pprof/profile?seconds=60
Saved profile in /Users/eddycjy/pprof/pprof.samples.cpu.007.pb.gz
Type: cpu
Duration: 1mins, Total samples = 26.55s (44.15%)
Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)
(pprof)
</code></pre>

<p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œéœ€ç­‰å¾… 60 ç§’ï¼ˆå¯è°ƒæ•´ seconds çš„å€¼ï¼‰ï¼Œpprof ä¼šè¿›è¡Œ CPU Profilingã€‚ç»“æŸåå°†é»˜è®¤è¿›å…¥ pprof çš„äº¤äº’å¼å‘½ä»¤æ¨¡å¼ï¼Œå¯ä»¥å¯¹åˆ†æçš„ç»“æœè¿›è¡ŒæŸ¥çœ‹æˆ–å¯¼å‡ºã€‚å…·ä½“å¯æ‰§è¡Œ pprof help æŸ¥çœ‹å‘½ä»¤è¯´æ˜</p>

<pre><code>(pprof) top10
Showing nodes accounting for 25.92s, 97.63% of 26.55s total
Dropped 85 nodes (cum &lt;= 0.13s)
Showing top 10 nodes out of 21
      flat  flat%   sum%        cum   cum%
    23.28s 87.68% 87.68%     23.29s 87.72%  syscall.Syscall
     0.77s  2.90% 90.58%      0.77s  2.90%  runtime.memmove
     0.58s  2.18% 92.77%      0.58s  2.18%  runtime.freedefer
     0.53s  2.00% 94.76%      1.42s  5.35%  runtime.scanobject
     0.36s  1.36% 96.12%      0.39s  1.47%  runtime.heapBitsForObject
     0.35s  1.32% 97.44%      0.45s  1.69%  runtime.greyobject
     0.02s 0.075% 97.51%     24.96s 94.01%  main.main.func1
     0.01s 0.038% 97.55%     23.91s 90.06%  os.(*File).Write
     0.01s 0.038% 97.59%      0.19s  0.72%  runtime.mallocgc
     0.01s 0.038% 97.63%     23.30s 87.76%  syscall.Write
flatï¼šç»™å®šå‡½æ•°ä¸Šè¿è¡Œè€—æ—¶
flat%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹
sum%ï¼šç»™å®šå‡½æ•°ç´¯ç§¯ä½¿ç”¨ CPU æ€»æ¯”ä¾‹
cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒä¹‹ä¸Šçš„è°ƒç”¨è¿è¡Œæ€»è€—æ—¶
cum%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹
æœ€åä¸€åˆ—ä¸ºå‡½æ•°åç§°ï¼Œåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº”åˆ—å¾—å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼ŒåŠ ä»¥ä¼˜åŒ– ğŸ¤”
</code></pre>

<p>ï¼ˆ2ï¼‰go tool pprof <a href="http://localhost:6060/debug/pprof/heap">http://localhost:6060/debug/pprof/heap</a></p>

<pre><code>$ go tool pprof http://localhost:6060/debug/pprof/heap
Fetching profile over HTTP from http://localhost:6060/debug/pprof/heap
Saved profile in /Users/eddycjy/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.008.pb.gz
Type: inuse_space
Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)
(pprof) top
Showing nodes accounting for 837.48MB, 100% of 837.48MB total
      flat  flat%   sum%        cum   cum%
  837.48MB   100%   100%   837.48MB   100%  main.main.func1
-inuse_spaceï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å¸¸é©»å†…å­˜å ç”¨æƒ…å†µ
-alloc_objectsï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸´æ—¶åˆ†é…æƒ…å†µ
</code></pre>

<p>ï¼ˆ3ï¼‰ go tool pprof <a href="http://localhost:6060/debug/pprof/block">http://localhost:6060/debug/pprof/block</a></p>

<p>ï¼ˆ4ï¼‰ go tool pprof <a href="http://localhost:6060/debug/pprof/mutex">http://localhost:6060/debug/pprof/mutex</a></p>

<p>ä¸‰ã€PProf å¯è§†åŒ–ç•Œé¢</p>

<p>ç¼–å†™æµ‹è¯•ç”¨ä¾‹</p>

<pre><code>package data

import &quot;testing&quot;

const url = &quot;https://github.com/EDDYCJY&quot;

func TestAdd(t *testing.T) {
    s := Add(url)
    if s == &quot;&quot; {
        t.Errorf(&quot;Test.Add error!&quot;)
    }
}

func BenchmarkAdd(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        Add(url)
    }
}
</code></pre>

<p>ï¼ˆ2ï¼‰æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</p>

<pre><code>$ go test -bench=. -cpuprofile=cpu.prof
pkg: github.com/EDDYCJY/go-pprof-example/data
BenchmarkAdd-4       10000000           187 ns/op
PASS
ok      github.com/EDDYCJY/go-pprof-example/data    2.300s
</code></pre>

<p>å¯åŠ¨ PProf å¯è§†åŒ–ç•Œé¢</p>

<pre><code>æ–¹æ³•ä¸€ï¼š
$ go tool pprof -http=:8080 cpu.prof
æ–¹æ³•äºŒï¼š
$ go tool pprof cpu.prof
$ (pprof) web
</code></pre>

<p>å¦‚æœå‡ºç° Could not execute dot; may need to install graphviz.ï¼Œå°±æ˜¯æç¤ºä½ è¦å®‰è£… graphviz äº† ï¼ˆè¯·å³æ‹è°·æ­Œï¼‰</p>

<p>æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢ï¼Œä¸‹é¢æ˜¯url</p>

<pre><code>ï¼ˆ1ï¼‰Top
ï¼ˆ2ï¼‰Graph
æ¡†è¶Šå¤§ï¼Œçº¿è¶Šç²—ä»£è¡¨å®ƒå ç”¨çš„æ—¶é—´è¶Šå¤§å“¦
ï¼ˆ3ï¼‰Peek
ï¼ˆ4ï¼‰Source
</code></pre>

<p>é€šè¿‡ PProf çš„å¯è§†åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿ã€æ›´ç›´è§‚çš„çœ‹åˆ° Go åº”ç”¨ç¨‹åºçš„è°ƒç”¨é“¾ã€ä½¿ç”¨æƒ…å†µç­‰ï¼Œå¹¶ä¸”åœ¨ View èœå•æ ä¸­ï¼Œè¿˜æ”¯æŒå¦‚ä¸Šå¤šç§æ–¹å¼çš„åˆ‡æ¢</p>

<p>å››ã€PProf ç«ç„°å›¾</p>

<p>å¦ä¸€ç§å¯è§†åŒ–æ•°æ®çš„æ–¹æ³•æ˜¯ç«ç„°å›¾ï¼Œéœ€æ‰‹åŠ¨å®‰è£…åŸç”Ÿ PProf å·¥å…·ï¼š</p>

<p>ï¼ˆ1ï¼‰ å®‰è£… PProf</p>

<pre><code>$ go get -u github.com/google/pprof
</code></pre>

<p>ï¼ˆ2ï¼‰ å¯åŠ¨ PProf å¯è§†åŒ–ç•Œé¢:</p>

<pre><code>$ pprof -http=:8080 cpu.prof
</code></pre>

<p>ï¼ˆ3ï¼‰ æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢</p>

<p>æ‰“å¼€ PProf çš„å¯è§†åŒ–ç•Œé¢æ—¶ï¼Œä½ ä¼šæ˜æ˜¾å‘ç°æ¯”å®˜æ–¹å·¥å…·é“¾çš„ PProf ç²¾è‡´ä¸€äº›ï¼Œå¹¶ä¸”å¤šäº† Flame Graphï¼ˆç«ç„°å›¾ï¼‰</p>

<p>å®ƒå°±æ˜¯æœ¬æ¬¡çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯åŠ¨æ€çš„ã€‚è°ƒç”¨é¡ºåºç”±ä¸Šåˆ°ä¸‹ï¼ˆA -&gt; B -&gt; C -&gt; Dï¼‰ï¼Œæ¯ä¸€å—ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œè¶Šå¤§ä»£è¡¨å ç”¨ CPU çš„æ—¶é—´æ›´é•¿ã€‚åŒæ—¶å®ƒä¹Ÿæ”¯æŒç‚¹å‡»å—æ·±å…¥è¿›è¡Œåˆ†æï¼</p>

<p>è¿˜å¯ä»¥ä½¿ç”¨gzæ–‡ä»¶</p>

<p>1.è·å–cpuprofile</p>

<p>è·å–æœ€è¿‘10ç§’ç¨‹åºè¿è¡Œçš„cpuprofile,-secondså‚æ•°ä¸å¡«é»˜è®¤ä¸º30ã€‚</p>

<pre><code>go tool pprof http://127.0.0.1:8080/debug/pprof/profile -seconds 10
</code></pre>

<p>ç­‰10såä¼šç”Ÿæˆä¸€ä¸ª: pprof.samples.cpu.001.pb.gzæ–‡ä»¶</p>

<p>2.ç”Ÿæˆç«ç„°å›¾</p>

<pre><code>go tool pprof -http=:8081 ~/pprof/pprof.samples.cpu.001.pb.gz
</code></pre>

<p>å…¶ä¸­-http=:8081ä¼šå¯åŠ¨ä¸€ä¸ªhttpæœåŠ¡,ç«¯å£ä¸º8081,ç„¶åæµè§ˆå™¨ä¼šå¼¹å‡ºæ­¤æ–‡ä»¶çš„å›¾è§£</p>

            </div>
            
            <div style="border: 1px dashed #e0e0e0; margin-bottom: 15px; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
                <div>
                    <p style="margin-top:0px;">ä½œè€…ï¼š<a target="_blank" href="http://blog.fatedier.com/">kingjcy</a>
                    <br />æœ¬æ–‡å‡ºå¤„ï¼š<a target="_blank" href="https://kingjcy.github.io/post/golang/go-net-http-pporf/">https://kingjcy.github.io/post/golang/go-net-http-pporf/</a>
                    <br />
                    æ–‡ç« ç‰ˆæƒå½’æœ¬äººæ‰€æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚ </p>
                </div>
            </div>

            <aside>
                
                <ul class="list-inline post-tags">
                    
                    <li>
                        <a href="/tags/golang/">
                            <i class="fa fa-tags"></i>
                            golang
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/net/">
                            <i class="fa fa-tags"></i>
                            net
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/http/">
                            <i class="fa fa-tags"></i>
                            http
                        </a>
                    </li>
                    
                    <li>
                        <a href="/tags/pporf/">
                            <i class="fa fa-tags"></i>
                            pporf
                        </a>
                    </li>
                    
                </ul>

                
                
                <h4 id="real-rels">ç›¸å…³æ–‡ç« </h4>
                <ul class="post-rels" id="real-rels"><li id="li-rels"><a href="/post/golang/benchmark/">golangä½¿ç”¨ç³»åˆ—---- Benchmark</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2020å¹´01æœˆ10æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-crypto-tls/">Golangä½¿ç”¨ç³»åˆ—---- Crypto/Tls</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´11æœˆ19æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-web-safe/">Golang webç³»åˆ—---- Safe</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´11æœˆ10æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-rate/">Golangä½¿ç”¨ç³»åˆ—---- Rate</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´11æœˆ10æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-container-list/">golangä½¿ç”¨ç³»åˆ—---- List</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´10æœˆ11æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-container-heap/">golangä½¿ç”¨ç³»åˆ—---- heap</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´10æœˆ11æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-proxy/">golangç³»åˆ—---- Go Proxy</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´10æœˆ07æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-gc/">golangä½¿ç”¨ç³»åˆ—---- Gc</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´08æœˆ27æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-encode/">Golangä½¿ç”¨ç³»åˆ—---- encode</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´06æœˆ17æ—¥)</span></li><li id="li-rels"><a href="/post/golang/go-crypto/">golangä½¿ç”¨ç³»åˆ—---- Crypto</a>&nbsp;&nbsp;<span class="post-date" style="font-size:14px">&nbsp;(2019å¹´06æœˆ06æ—¥)</span></li></ul>
            </aside>
                
            
            <footer>
                <nav>
                    <ul class="pager">

                        
                        <li class="previous"><a href="/post/monitor/prometheus/exporter/script_exporter/"><span aria-hidden="true">&larr;</span> Prev</a></li>
                        

                        <li><a href="/post/">All Posts</a></li>

                        
                        <li class="next"><a href="/post/architecture/microservices/go-kit/">Next <span aria-hidden="true">&rarr;</span></a></li>
                        

                    </ul>
                </nav>
            </footer>

        </article>
    </div>
    <div class="col-md-4">
        
<aside>
        <div class="toc panel panel-default hidden-xs hidden-sm affix-top" data-spy="affix" data-offset-top="125" data-offset-bottom="300">
            <div class="panel-heading">
                <h2 class="panel-title">Catalog</h2>
            </div>

            <nav id="TableOfContents">
<ul>
<li><a href="#pprof">PProf</a></li>
<li><a href="#åŸç†">åŸç†</a></li>
<li><a href="#ä½¿ç”¨">ä½¿ç”¨</a></li>
<li><a href="#å®ä¾‹">å®ä¾‹</a></li>
<li><a href="#åˆ†æ">åˆ†æ</a></li>
</ul>
</nav>
        </div>
</aside>

    </div>
</div>

</div>
<hr>

<footer class="container copy">
    <p>&copy; 2020  kingjcy blog </p>
	<p>Powered by <a href="https://gohugo.io" target="_blank">Hugo</a></p>
</footer>

<script>hljs.initHighlightingOnLoad();</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?ace3ec99de96c4080ead1eb8d52db3b3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92600390-2', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>

